# NFC Card Backend Deployment Guide

This guide walks through setting up MongoDB Atlas, configuring an AWS S3 bucket, and deploying the backend to Render using the included `render.yaml`.

## 1. MongoDB Atlas Setup
- Sign up at https://www.mongodb.com/cloud/atlas and create a free cluster.
- Create a Database User with a username and strong password (save these).
- Under Network Access, allow connections from your environment:
  - For testing, you can allow `0.0.0.0/0` (not recommended for production).
  - For production, add specific IPs as needed.
- Get your connection string:
  - Click "Connect" → "Connect your application" → choose Node.js driver.
  - Copy the URI and replace `<username>`, `<password>`, and add the database name, e.g.:
    - `mongodb+srv://<username>:<password>@cluster0.xxxxxx.mongodb.net/elitecards`
- In Render, set `MONGODB_URI` to this complete URI.

## 2. AWS S3 Bucket Setup
- Sign in to AWS and open the S3 console.
- Create a new bucket:
  - Choose a globally unique bucket name.
  - Select a region (e.g., `ap-south-1`).
  - Keep "Block all public access" ON unless you need direct public access to images. If public access is required, configure bucket policies and CORS carefully.
- Create an IAM user for programmatic access:
  - Go to IAM → Users → Add users.
  - Enable "Access key - Programmatic access".
  - Attach a policy scoped to your bucket, e.g. (replace `YOUR_BUCKET_NAME` and `YOUR_REGION`):
```
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:PutObject",
        "s3:GetObject",
        "s3:DeleteObject"
      ],
      "Resource": "arn:aws:s3:::YOUR_BUCKET_NAME/*"
    }
  ]
}
```
- Save the `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` for the IAM user.
- (Optional) Configure CORS if you will access images directly from web clients:
```
[
  {
    "AllowedHeaders": ["*"],
    "AllowedMethods": ["GET", "PUT", "POST", "DELETE"],
    "AllowedOrigins": ["*"]
  }
]
```
- Note your `AWS_REGION` and bucket name (`AWS_BUCKET_NAME`).

## 3. Deploy to Render
- Ensure `render.yaml` exists at the repository root (it is included).
- In Render, create a new Web Service:
  - Connect your GitHub repository.
  - Render will detect `render.yaml` and propose the service.
  - Confirm the service details:
    - Type: `web`
    - Name: `nfc-card-backend`
    - Env: `node`
    - Root Directory: `backend/nfc-card-backend`
    - Build Command: `npm install`
    - Start Command: `npm start`
- Add environment variables (see next section).
- Deploy and monitor logs. Once running, note the service URL.

## 4. Environment Variables
Set these variables in Render (some are declared in `render.yaml`):
- `NODE_ENV`: `production`
- `MONGODB_URI`: Your MongoDB Atlas connection URI.
- `JWT_SECRET`: Auto-generated via `render.yaml` or set a strong secret.
- `AWS_ACCESS_KEY_ID`: IAM access key.
- `AWS_SECRET_ACCESS_KEY`: IAM secret key.
- `AWS_REGION`: Your AWS region (e.g., `ap-south-1`).
- `AWS_BUCKET_NAME`: Your S3 bucket name.
- (Optional) `PORT`: Defaults to `5000`. Render sets `PORT` automatically; the app reads it.

---

Troubleshooting
- MongoDB connection issues: verify `MONGODB_URI` and Atlas network access settings.
- S3 upload failures: confirm IAM policy, region, and bucket name. Ensure CORS if accessing images from browsers.
- JWT errors: ensure `JWT_SECRET` is set in Render or generated by `render.yaml`.
- Check Render logs for build/runtime errors.